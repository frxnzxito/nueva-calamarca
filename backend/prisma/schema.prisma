generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Rol {
  id        Int      @id @default(autoincrement())
  nombre    String   @unique
  usuarios  Usuario[]
}

model Mina {
  id            Int      @id @default(autoincrement())
  nombre        String
  encargado     Usuario[] // Relaci√≥n inversa
  producciones  Produccion[]
}

model Usuario {
  id            Int      @id @default(autoincrement())
  ci            String   @unique
  apellidos     String
  nombres       String
  foto          String?
  rolId         Int
  minaId        Int?
  passwordHash  String? @default("")

  rol       Rol      @relation(fields: [rolId], references: [id])
  mina      Mina?    @relation(fields: [minaId], references: [id])
  asistencias Asistencia[]
  produccionesPerforista Produccion[] @relation("Perforista")
  produccionesEncargado Produccion[] @relation("Encargado")
  produccionesAyudante  Produccion[] @relation("Ayudante")
}

model Produccion {
  id               Int      @id @default(autoincrement())
  fecha            DateTime
  minaId           Int
  turnoId          Int
  encargadoId      Int
  perforistaId     Int
  ayudanteId       Int
  topesPerforados  Int
  carrosSacados    Int
  sacosSacados     Int

  mina             Mina     @relation(fields: [minaId], references: [id])
  encargado        Usuario  @relation("Encargado", fields: [encargadoId], references: [id])
  perforista       Usuario  @relation("Perforista", fields: [perforistaId], references: [id])
  ayudante         Usuario  @relation("Ayudante", fields: [ayudanteId], references: [id])
  turno            Turno    @relation(fields: [turnoId], references: [id])
}

model Turno {
  id      Int      @id @default(autoincrement())
  nombre  String   @unique
  asistencias Asistencia[]
  producciones Produccion[]
}

model PuestoTrabajo {
  id      Int      @id @default(autoincrement())
  nombre  String   @unique
  asistencias Asistencia[]
}

model Asistencia {
  id              Int      @id @default(autoincrement())
  fecha           DateTime
  usuarioId       Int
  turnoId         Int
  puestoTrabajoId Int
  usuario         Usuario  @relation(fields: [usuarioId], references: [id])
  turno           Turno    @relation(fields: [turnoId], references: [id])
  puestoTrabajo   PuestoTrabajo @relation(fields: [puestoTrabajoId], references: [id])
}

